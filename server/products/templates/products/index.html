{% extends 'server/master.html' %}

{% load static %}

{% block page_static %}
<link rel="stylesheet" href="{% static 'products/css/list.css' %}">
{% endblock %}

{% block page_title %}
Product list
{% endblock %}

{% block page_content %}

<h1>
    Список категорий
</h1>
<ul>
    {% for item in category_list %}
    <li>
        <a href="{% url 'categories:detail' pk=item.id %}" class="product_list_item-link">{{ item.name }}</a>
    </li>
    {% endfor %}
</ul>

<h1>Product List</h1>
<div class="products">
    {% for itm in page_object %}
    {% include 'server/product.html' with image=itm.image name=itm.name description=itm.description cost=itm.cost id=itm.id  %}
    {% endfor %}
</div>
<ul class="pagination">
    {% if page_object.has_previous %}
    <li>
        <a href="?page={{ page_object.previous_page_number }}">Back</a>
    </li>
    {% endif %}
    {% if page_object.has_next %}
    <li>
        <a href="?page={{ page_object.next_page_number }}">Next</a>
    </li>
    {% endif %}

    {% for item in page_object.paginator.page_range %}
    <li>
            <a href="?page={{ item }}">{{ item }}</a>
    </li>
    {% endfor %}

</ul>

<button id="load-button">Показать все</button>
{% endblock %}

{% block page_scripts %}
<script>
    const url = 'http://127.0.0.1:8000/products/api/';
    const container = document.querySelector('.products');
    const loadButton = document.querySelector('#load-button');

    const asyncLoadData = () => {
        fetch(url).then(
            response => response.json())
            .then(response => {
                loadedHtml = ''
                response.results.map(
                    item => { loadedHtml += renderProduct(item) }
                )
                container.innerHTML = loadedHtml
            }
            )
    };



    const renderProduct = ({ id, name, image, description, cost }) => (
        `
    <div class="products__item">
        <img class="products__item-image" src="${ image}" alt="${name}">
        <span class="products__item-name">
            ${ name}
        </span>
        <span class="products__item-description">
            ${ description}
        </span>
        <span class="products__item-cost">
            ${ cost}
        </span>
        <a href="${ id}" class="products__item-link">
            Перейти
        </a>
    </div>
    `
    );

    loadButton.addEventListener('click', asyncLoadData);

</script>
{% endblock %}